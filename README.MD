# ğŸ›°ï¸ Trackify - Backend

Trackify es un proyecto backend construido con **FastAPI**, **RabbitMQ**, **PostgreSQL**, y sigue los principios de **arquitectura hexagonal**, **CQRS** y **event-driven architecture**.

---

## ğŸ“ Estructura del Proyecto

```
trackify/
â”œâ”€â”€ contexts/
â”‚   â”œâ”€â”€ users/
â”‚   â”‚   â”œâ”€â”€ application/
â”‚   â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”œâ”€â”€ infrastructure/
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ application/
â”‚   â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”œâ”€â”€ infrastructure/
â”œâ”€â”€ interfaces/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ routes/
â”‚   â”‚   â””â”€â”€ middlewares/
â”‚   â”‚   â””â”€â”€ schemas/
â”‚   â”œâ”€â”€ consumers/
â”‚   â”‚   â””â”€â”€ rabbitmq/
â”‚   â””â”€â”€ middleware/
â”œâ”€â”€ shared/
â”‚   â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ infrastructure/
â”œâ”€â”€ tests/
â”œâ”€â”€ .docker/
â”‚   â””â”€â”€ resources/
â”‚       â””â”€â”€ start.sh
â”‚   â””â”€â”€ Dockerfile
â”œâ”€â”€ main_consumer.py
â””â”€â”€ docker-compose.yml
```

- `contexts/`: Contiene los **bounded contexts** (`users`, `auth`), cada uno con su capa `application`, `domain` e `infrastructure`.
- `interfaces/`: Entrada/salida del sistema: api(rutas, middlewares y validadores) y consumidores de eventos
- `shared/`: Configuraciones comunes entre contextos.
- `.docker/` y `.docker/resources`: Configuraciones necesarias para ejecutar el proyecto en contenedores.
- `main_consumer.py`: Inicia los consumidores de eventos.

---

## ğŸš€ CÃ³mo ejecutar el proyecto

### ğŸ“¦ Requisitos

- Docker + Docker Compose

### ğŸ”§ Variables de entorno

Configura un archivo `.env` en la raÃ­z del proyecto. Puedes guiarte de `.env.example`:

```env
DB_HOST=postgres
DB_PORT=5432
DB_DATABASE=trackify
DB_USER=postgres
DB_PASSWORD=secret

RABBITMQ_HOST=rabbitmq
RABBITMQ_PORT=5672
RABBITMQ_USER=guest
RABBITMQ_PASSWORD=guest
RABBITMQ_VHOST=/

JWT_SECRET=supersecretjwt
```

### â–¶ï¸ Levantar la app

```bash
docker compose up --build -d
```

Esto levantarÃ¡:

- FastAPI (puerto `8000`)
- RabbitMQ (puerto `5672`)
- PostgreSQL (puerto `5432`)

El script `start.sh` se encarga de ejecutar las migraciones y levantar tanto la app como los consumidores de eventos.

### âœ… Ejecutar las migraciones

Las migraciones se debej ejecutar manualmente:

```bash
docker compose exec app alembic upgrade head
```

---

## ğŸ§ª Ejecutar pruebas

Las pruebas usan `pytest`. Puedes ejecutarlas con:

```bash
docker compose exec app pytest tests/
```

---

## ğŸ§± Decisiones arquitectÃ³nicas

### ğŸ”„ Arquitectura Hexagonal

- SeparaciÃ³n clara entre **dominio**, **aplicaciÃ³n** e **infraestructura**.
- Las entidades y lÃ³gica de negocio no dependen de frameworks externos.
- Se utilizan interfaces para abstraer la persistencia y transporte.

### ğŸ“¤ CQRS + Event Driven

- **Commands** para mutaciones (`CreateUserCommand`).
- **Queries** (lecturas) separadas, accediendo directamente a la tabla de lectura.
- **Eventos de dominio** propagados vÃ­a **RabbitMQ** (ej. `UserCreatedEvent`).
- Cada consumidor maneja su propio fallo y reintentos (con DLQ).

### ğŸ” Seguridad

- AutenticaciÃ³n JWT con middleware personalizado para verificar y validar expiraciÃ³n.
- Cada contexto maneja sus propias excepciones y validaciones.

---

## ğŸ“¬ Endpoints principales

| MÃ©todo | Endpoint      | DescripciÃ³n            |
| ------ | ------------- | ---------------------- |
| POST   | `/auth`       | Login de usuario (JWT) |
| POST   | `/users`      | Crear un usuario       |
| GET    | `/users/{id}` | Obtener usuario por ID |

### ğŸ“ Ejemplo de body para `POST /users`

```json
{
  "first_name": "JosÃ© Omar",
  "last_name": "Vegas",
  "middle_name": "Carrillo",
  "email": "omar41_41@hotmail.com",
  "password": "Probando@1",
  "gender": "M",
  "age": 26
}
```

---

## ğŸ§  Consideraciones finales

- Soporte completo para pruebas unitarias y de integraciÃ³n.
- Alto desacoplamiento entre capas.
- Cada contexto puede evolucionar de forma independiente.
- Docker-ready para despliegue local o CI/CD.
